<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Infographic Editor</title>

  <!-- Fonts (fallback si Funnel Display non chargée) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400&display=swap" rel="stylesheet">

  <style>
    * { box-sizing: border-box; }

    body{
      margin:0;
      min-height:100vh;
      display:grid;
      place-items:center;
      background:#1b1b1b;
      color:#fff;
      font-family: system-ui, sans-serif;
    }

    /* ======================
       EXPORTABLE BACKGROUND
       ====================== */
    .card{
      position: relative;
      width: 721px;
      height: 721px;
      background: #0F0F0F;
      overflow: hidden;
    }

    /* ======================
       TITLE
       ====================== */
    .title{
      position: absolute;
      top: 48px;
      left: 48px;

      color: #FFF;
      font-family: "Funnel Display", system-ui, sans-serif;
      font-size: 80px;
      font-weight: 400;
      line-height: 81.5px;
      margin: 0;
      white-space: pre-line;
    }

    /* ======================
       PERCENTAGE VALUE
       ====================== */
    .value{
      position: absolute;
      left: 48px;
      bottom: 48px;

      display: flex;
      width: 552px;
      height: 171px;
      flex-direction: column;
      justify-content: center;

      color: #FFF;
      font-family: "Roboto Mono", monospace;
      font-size: 240px;
      font-weight: 400;
      line-height: 121.5px;
      letter-spacing: -6px;
    }

    .value span{
      display: inline-block;
    }

    /* ======================
       GAUGE
       ====================== */
    .gauge{
      position: absolute;
      right: 32px;
      top: 160px;
      width: 522px;
      height: 522px;
      pointer-events: none;
    }

    /* ======================
       CONTROLS (NON EXPORTÉS)
       ====================== */
    .ui{
      margin-top: 24px;
      display: flex;
      gap: 12px;
      align-items: center;
      flex-wrap: wrap;
    }

    .ui input[type="range"]{ width: 200px; }
    .ui input[type="number"],
    .ui input[type="text"]{
      background:#111;
      border:1px solid rgba(255,255,255,.2);
      color:#fff;
      padding:8px 10px;
      border-radius:8px;
    }

    .ui button{
      background:#111;
      border:1px solid rgba(255,255,255,.25);
      color:#fff;
      padding:8px 12px;
      border-radius:8px;
      cursor:pointer;
    }
  </style>
</head>

<body>

  <!-- VISUEL EXPORTABLE -->
  <div class="card" id="exportArea">

    <!-- GAUGE -->
    <svg class="gauge" viewBox="0 0 300 300">
      <defs>
        <radialGradient id="arcGradient" cx="50%" cy="50%" r="50%">
          <stop offset="0%" stop-color="rgba(56,113,225,0)" />
          <stop offset="100%" stop-color="#3871E1" />
        </radialGradient>
      </defs>

      <path id="track" fill="none" stroke="rgba(255,255,255,.08)" stroke-width="80" />
      <path id="arc" fill="none" stroke="url(#arcGradient)" stroke-width="80" />
    </svg>

    <!-- TITLE -->
    <h1 class="title" id="titleText">Security<br>rating</h1>

    <!-- VALUE -->
    <div class="value">
      <span id="pctText">80%</span>
    </div>
  </div>

  <!-- CONTROLS -->
  <div class="ui">
    <input id="range" type="range" min="0" max="100" value="80">
    <input id="num" type="number" min="0" max="100" value="80">
    <input id="titleInput" type="text" value="Security\nrating">
    <button id="exportPng">Export PNG</button>
  </div>

  <!-- html2canvas -->
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

  <script>
    const track = document.getElementById('track');
    const arc = document.getElementById('arc');
    const pctText = document.getElementById('pctText');
    const range = document.getElementById('range');
    const num = document.getElementById('num');
    const titleText = document.getElementById('titleText');
    const titleInput = document.getElementById('titleInput');
    const exportBtn = document.getElementById('exportPng');
    const exportArea = document.getElementById('exportArea');

    const cx = 150, cy = 150;
    const radius = 95;
    const startAngle = -60;
    const sweepAngle = 300;

    function polarToCartesian(cx, cy, r, angle) {
      const rad = (angle - 90) * Math.PI / 180;
      return { x: cx + r * Math.cos(rad), y: cy + r * Math.sin(rad) };
    }

    function describeArc(start, end) {
      const s = polarToCartesian(cx, cy, radius, end);
      const e = polarToCartesian(cx, cy, radius, start);
      const large = end - start <= 180 ? 0 : 1;
      return `M ${s.x} ${s.y} A ${radius} ${radius} 0 ${large} 0 ${e.x} ${e.y}`;
    }

    function setGauge(v){
      v = Math.max(0, Math.min(100, v));
      pctText.textContent = v + "%";

      track.setAttribute("d", describeArc(startAngle, startAngle + sweepAngle));
      arc.setAttribute("d", describeArc(startAngle, startAngle + sweepAngle * v / 100));
    }

    function sync(v){
      range.value = v;
      num.value = v;
      setGauge(v);
    }

    range.oninput = e => sync(e.target.value);
    num.oninput = e => sync(e.target.value);

    titleInput.oninput = e => {
      titleText.innerHTML = e.target.value.replaceAll("\\n","<br>");
    };

    exportBtn.onclick = async () => {
      const canvas = await html2canvas(exportArea, { scale: 2 });
      const link = document.createElement("a");
      link.download = "infographic.png";
      link.href = canvas.toDataURL("image/png");
      link.click();
    };

    sync(80);
  </script>
</body>
</html>

